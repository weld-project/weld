language: rust
sudo: required
dist: trusty

python:
  - 2.7

addons:
  apt:
    sources:
      - llvm-toolchain-trusty-4.0
    packages:
      - gcc
      - llvm-4.0
      - llvm-4.0-dev
      - clang-4.0
      - make
      - lib32z1-dev

install:
  - sudo rm -rf /usr/bin/llvm-config
  - sudo rm -rf `which llvm-config`
  - sudo ln -s /usr/bin/llvm-config-4.0 /usr/bin/llvm-config
  - export WELD_HOME=`pwd`
  - cd python
  - pip install --upgrade pip setuptools wheel
  - pip install --only-binary=numpy,pandas -r requirements.txt
  - python setup.py install
  - cd ..

script:
  - cargo build --release
  - cargo test
  - python python/grizzly/tests/grizzly_test.py
  - python python/grizzly/tests/numpy_weld_test.py
